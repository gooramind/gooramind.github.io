<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="tooltip" style="display:none; position:absolute; background:rgba(0, 0, 0, 0.7); color:white; padding:10px; border-radius:5px; font-size:14px;"></div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const tooltip = document.getElementById("tooltip");

    let currentScreen = "start";
    const maxDeckSlots = 5;
    const deckSlots = Array(maxDeckSlots).fill(null);
    const characterData = [
        { name: "아처", imageName: "archer", concept: "활에서 화살이 나감", attack: 1700, health: 2000, range: 400, speed: 10 },
        { name: "아티스트", imageName: "artist", concept: "물감의 색을 정함", attack: 1000, health: 3000, range: 375, speed: 12 },
        { name: "폭주족", imageName: "biker", concept: "오토바이로 적을 들이박음", attack: 700, health: 1000, range: "150 ~ 0", speed: 20 },
        { name: "복서", imageName: "boxer", concept: "원투 3타로 스트레이트 주먹 공격", attack: "50, 50, 500", health: 3000, range: 250, speed: 13 },
        { name: "박사", imageName: "doctor", concept: "책을 읽는다", attack: 0, health: 500, range: 0, speed: 0 },
        { name: "자이언트", imageName: "giant", concept: "양손을 들어 공격", attack: 1200, health: 10000, range: "250 ~ -250", speed: 10 },
        { name: "나이트", imageName: "knight", concept: "칼을 휘두르며 공격", attack: 700, health: 6000, range: 200, speed: 15 },
        { name: "안전요원", imageName: "lifeguard", concept: "메가폰으로 공격", attack: 200, health: 1000, range: "450 ~ 0", speed: 14 },
        { name: "마법사", imageName: "magician", concept: "지팡이로 파이어볼 공격", attack: 1200, health: 2500, range: 425, speed: 12 },
        { name: "사이언티스트", imageName: "scientist", concept: "약품을 사용", attack: 0, health: 800, range: 10, speed: 2 },
        { name: "방패병", imageName: "shield", concept: "방패로 공격", attack: 300, health: 10000, range: 150, speed: 12 },
        { name: "바이킹", imageName: "viking", concept: "도끼로 공격", attack: 1200, health: 4000, range: 150, speed: 18 }
    ];

    const characterImages = {};

    function loadImages(callback) {
        let loadedImages = 0;
        characterData.forEach(character => {
            const img = new Image();
            img.src = `https://doopyo85.github.io/img/${character.imageName}.webp`;
            img.onload = () => {
                characterImages[character.imageName] = img;
                loadedImages++;
                if (loadedImages === characterData.length) callback();
            };
        });
    }

    function drawStartScreen() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.font = "30px Arial";
        ctx.fillText("캐릭터들 등장!", 250, 200);
        ctx.fillStyle = "yellow";
        ctx.fillRect(300, 350, 200, 50);
        ctx.fillStyle = "black";
        ctx.font = "20px Arial";
        ctx.fillText("게임 시작", 340, 380);
    }

    function drawLobbyScreen() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 상단 덱 슬롯 텍스트
        ctx.font = "20px Arial";
        ctx.fillStyle = "black";
        ctx.fillText("덱 슬롯:", 50, 50);

        // 하단 캐릭터 카드 텍스트
        ctx.fillText("전체 캐릭터 카드", 50, 180);

        // 상단 덱 슬롯
        for (let i = 0; i < maxDeckSlots; i++) {
            const slotX = 100 + i * 120;
            ctx.strokeStyle = "black";
            ctx.strokeRect(slotX, 30, 100, 100);
            if (deckSlots[i]) {
                const img = characterImages[deckSlots[i].imageName];
                if (img) ctx.drawImage(img, slotX, 30, 100, 100);
            }
        }

        // 하단 캐릭터 카드 목록
        characterData.forEach((character, index) => {
            const x = 100 + (index % 6) * 120;
            const y = 200 + Math.floor(index / 6) * 120;
            const img = characterImages[character.imageName];
            if (img) {
                ctx.drawImage(img, x, y, 100, 100);
            }
        });

        // 배틀 스타트 버튼
        ctx.fillStyle = "red";
        ctx.fillRect(650, 20, 120, 40);
        ctx.fillStyle = "white";
        ctx.fillText("배틀 스타트", 660, 45);
    }

    function addToDeck(character) {
        const emptySlotIndex = deckSlots.findIndex(slot => slot === null);
        if (emptySlotIndex !== -1) {
            deckSlots[emptySlotIndex] = character;
            drawLobbyScreen();
        }
    }

    function removeFromDeck(slotIndex) {
        deckSlots[slotIndex] = null;
        drawLobbyScreen();
    }

    canvas.addEventListener("click", (e) => {
        const x = e.offsetX;
        const y = e.offsetY;

        if (currentScreen === "start" && x > 300 && x < 500 && y > 350 && y < 400) {
            currentScreen = "lobby";
            drawLobbyScreen();
        } else if (currentScreen === "lobby") {
            if (x > 650 && x < 770 && y > 20 && y < 60) {
                alert("배틀 화면으로 전환됩니다.");
            }

            for (let i = 0; i < maxDeckSlots; i++) {
                const slotX = 100 + i * 120;
                if (x > slotX && x < slotX + 100 && y > 30 && y < 130 && deckSlots[i]) {
                    removeFromDeck(i);
                    return;
                }
            }

            characterData.forEach((character, index) => {
                const cardX = 100 + (index % 6) * 120;
                const cardY = 200 + Math.floor(index / 6) * 120;
                if (x > cardX && x < cardX + 100 && y > cardY && y < cardY + 100) {
                    addToDeck(character);
                }
            });
        }
    });

    canvas.addEventListener("mousemove", (e) => {
        const x = e.offsetX;
        const y = e.offsetY;
        tooltip.style.display = "none";

        if (currentScreen === "lobby") {
            characterData.forEach((character, index) => {
                const cardX = 100 + (index % 6) * 120;
                const cardY = 200 + Math.floor(index / 6) * 120;
                if (x > cardX && x < cardX + 100 && y > cardY && y < cardY + 100) {
                    tooltip.style.display = "block";
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY + 10}px`;
                    tooltip.innerHTML = `
                        <strong>${character.name}</strong><br>
                        컨셉: ${character.concept}<br>
                        공격력: ${character.attack}<br>
                        체력: ${character.health}<br>
                        사거리: ${character.range}<br>
                        속도: ${character.speed}
                    `;
                }
            });
        }
    });

    loadImages(drawStartScreen);
</script>
